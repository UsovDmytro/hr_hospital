<odoo>
    <record id="hr_hospital_doctor_paperformat" model="report.paperformat">
        <field name="name">A4 library book</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">80</field>
        <field name="margin_bottom">15</field>
        <field name="margin_left">15</field>
        <field name="margin_right">15</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">15</field>
        <field name="dpi">180</field>
    </record>

    <record id="hr_hospital_doctor_report" model="ir.actions.report">
        <field name="name">Doctor report</field>
        <field name="model">hr.hospital.doctor</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">hr_hospital.hr_hospital_doctor_template</field>
        <field name="report_file">hr_hospital.hr_hospital_doctor_template</field>
        <field name="print_report_name">(object._get_report_base_filename())</field>
        <field name="attachment"/>
        <field name="binding_model_id" ref="model_hr_hospital_doctor"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="hr_hospital.hr_hospital_doctor_paperformat"/>
    </record>

    <template id="hr_hospital_doctor_info_company_template">
        <div style="text-align: center; margin-bottom: 20px;">
            <img t-attf-src="/logo.png?company={{ env.company.id }}"
                 style="padding: 0px; margin: 0px; height: 48px;"
                 t-att-alt="env.company.name"/>
            <br/>
            <t t-if="env.company">
                <h2>
                    <span t-field="env.company.name"/>
                </h2>
            </t>
        </div>
    </template>

    <template id="hr_hospital_doctor_info_template">
        <div style="max-width: 600px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
            <h1 style="font-size: 24px; margin-bottom: 20px; text-align: center;"><span t-field="o.name"/></h1>

            <t t-if="o.d_specialty_id">
                <div style="margin-bottom: 15px; text-align: center;">
                    <h2 style="font-size: 20px; font-weight: bold;">
                        <span t-field="o.d_specialty_id.name"/>
                    </h2>
                </div>
            </t>
            <table class="table table-condensed" style="font-size: 18px; margin-bottom: 10px;">
                <thead>
                    <tr>
                        <th>Date/time</th>
                        <th>Patient</th>
                        <th>State</th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="o.d_visit_ids" t-as="visit">
                        <td><span t-field="visit.visit_datetime"/></td>
                        <td><span t-field="visit.patient_id"/></td>
                        <td><span t-field="visit.state"/></td>
                   </tr>
                </tbody>
            </table>
        </div>
    </template>

    <template id="hr_hospital_doctor_patients_template">
        <div style="max-width: 600px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
            <h2 style="font-size: 18px; margin-bottom: 10px;">Patients:</h2>
            <table class="table table-condensed" style="font-size: 18px; margin-bottom: 10px;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Gender</th>
                        <th>Birthday</th>
                        <th>Phone</th>
                        <th>State visit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="o.d_patient_ids" t-as="patient">
                        <t t-set="record_state"
                            t-value="env['hr.hospital.visit'].search(
                            [
                            ('doctor_id','=',o.id),
                            ('patient_id','=',patient.id)
                            ],
                            order='visit_datetime desc',
                            limit=1)" />

                        <td><span t-field="patient.name"/></td>
                        <td><span t-field="patient.gender"/></td>
                        <td><span t-field="patient.birthday"/></td>
                        <td><span t-field="patient.phone"/></td>
                        <td><strong t-att-style="'background-color: green;' if record_state.state=='done' else 'background-color: yellow;' if record_state.state=='plan' else 'background-color: red;'" ><span t-out="record_state.state"/></strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </template>

    <template id="hr_hospital_doctor_template">
        <t t-call="web.basic_layout">
            <t t-foreach="docs" t-as="o">
                <div class="row" style="page-break-after: always;">
                    <div t-att="{'style':'font-size: 25px; padding: 5px;', 'name':'doctor_main_block'}">
                        <div t-att="['style', 'font-size: 45px;']" name="template_box">
                            <t t-call="hr_hospital.hr_hospital_doctor_info_company_template"/>
                            <t t-call="hr_hospital.hr_hospital_doctor_info_template"/>
                            <t t-call="hr_hospital.hr_hospital_doctor_patients_template"/>
                        </div>
                        <t t-esc="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/>
                        <div>
                            <span t-field="env.company.country_id"/>
                            <span t-field="env.company.state_id"/>
                            <span t-field="env.company.city"/>
                            <span t-field="env.company.street"/>
                            <span t-field="env.company.zip"/>
                        </div>
                    </div>
                </div>
            </t>
        </t>
    </template>

</odoo>